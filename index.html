<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인플루언서 스크리닝 통합 시트</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #f5f5f5;
        }

        .tab-container {
            background: white;
            border-bottom: 1px solid #ddd;
        }

        .tabs {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            background: #3498db;
            color: white;
            border-bottom: 3px solid #2980b9;
        }

        .tab:hover:not(.active) {
            background: #ecf0f1;
        }

        .content {
            max-width: 1600px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 12px;
        }

        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }

        .priority-s {
            background-color: #8e44ad;
            color: white;
        }

        .priority-a {
            background-color: #2ecc71;
            color: white;
        }

        .priority-b {
            background-color: #f39c12;
            color: white;
        }

        .priority-c {
            background-color: #95a5a6;
            color: white;
        }

        .priority-d {
            background-color: #e74c3c;
            color: white;
        }

        .score-input {
            width: 40px;
            text-align: center;
            border: none;
            background: transparent;
        }

        .total-score {
            font-weight: bold;
            font-size: 14px;
        }

        .add-btn,
        .delete-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .delete-btn {
            background: #e74c3c;
            padding: 5px 10px;
            font-size: 11px;
        }

        .add-btn:hover {
            background: #2980b9;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .budget-info {
            background: #e8f5e8;
            padding: 15px;
            border-left: 4px solid #2ecc71;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .firebase-status {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
        }

        .firebase-error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: center;
        }

        /* 기존 스타일들 동일하게 유지 */
        .sprint-week {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
        }

        .week-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .team-task {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #e74c3c;
        }

        .checklist-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #2ecc71;
        }

        .scoring-guide {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .outreach-strategy {
            background: #f0f8ff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .immediate-tasks {
            background: #ffe6e6;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #e74c3c;
        }

        .task-day {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #f39c12;
        }
    </style>
</head>

<body>
    <div class="tab-container">
        <div class="tabs">
            <div class="tab active" onclick="showTab('main')">메인 스크리닝</div>
            <div class="tab" onclick="showTab('checklist')">체크리스트 가이드</div>
            <div class="tab" onclick="showTab('sprint')">3주 스프린트 플랜</div>
            <div class="tab" onclick="showTab('reddit')">Reddit 바이럴 체크</div>
            <div class="tab" onclick="showTab('outreach')">인플루언서 대응 전략</div>
            <div class="tab" onclick="showTab('tasks')">당장 할 일</div>
        </div>
    </div>

    <div class="content">
        <!-- Firebase 상태 표시 -->
        <div id="firebaseStatus" class="loading">🔄 Firebase 연결 중...</div>

        <!-- 메인 스크리닝 탭 -->
        <div id="main" class="tab-content active">
            <h1>10월 아마존 빅이벤트 인플루언서 스크리닝 시트</h1>

            <div class="budget-info">
                <h3>🎯 목표</h3>
                <strong>10월 예산: 2억원</strong><br>
                <strong>리스팅 목표:</strong> 총 100명 인플루언서 리스팅<br>
                <strong>최종 목표:</strong> 10명 협업 성사 (S급 2명 + A급 8명)<br>
                <strong>컨택 목표:</strong> 30명 이상 컨택 (응답률 30% 가정)<br>
                <strong>마감:</strong> 9월 15일까지 1차 컨택 완료<br>
                <strong>플랫폼:</strong> Instagram + TikTok | <strong>팀원:</strong> 신희경, 최연주, 김유진
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalCandidates">0</div>
                    <div class="stat-label">총 후보</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="aPriority">0</div>
                    <div class="stat-label">S+A급</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="contacted">0</div>
                    <div class="stat-label">컨택완료</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="responded">0</div>
                    <div class="stat-label">답장받음</div>
                </div>
            </div>

            <div class="scoring-guide">
                <strong>📊 최소 기준:</strong><br>
                • <strong>Instagram:</strong> 팔로워 30만+ (참여율 3%+ 필수)<br>
                • <strong>TikTok:</strong> 팔로워 50만+ (최근 1개월 조회수 평균 10만+)<br>
                • <strong>공통:</strong> 최근 3개월 활동, 뷰티/라이프스타일 관련 콘텐츠 50%+<br>
                <strong>점수 기준:</strong> S급(90+점) 최우선 | A급(80+점) 즉시컨택 | B급(60-79점) 조건부 | C급(40-59점) 보류 | D급(40점 미만) 제외
            </div>

            <button class="add-btn" onclick="addInfluencer()">+ 인플루언서 추가</button>

            <table id="influencerTable">
                <thead>
                    <tr>
                        <th>순번</th>
                        <th>인플루언서명</th>
                        <th>플랫폼</th>
                        <th>브랜드</th>
                        <th>팔로워수</th>
                        <th>참여율</th>
                        <th>구매력<br>(20점)</th>
                        <th>신뢰성<br>(25점)</th>
                        <th>커뮤니티<br>(20점)</th>
                        <th>타겟매칭<br>(20점)</th>
                        <th>실사용<br>(15점)</th>
                        <th>Reddit<br>(10점)</th>
                        <th>총점</th>
                        <th>등급</th>
                        <th>담당자</th>
                        <th>컨택상태</th>
                        <th>희망단가</th>
                        <th>메모</th>
                        <th>삭제</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- 데이터는 Firebase에서 로드됨 -->
                </tbody>
            </table>
        </div>

        <!-- 나머지 탭들은 기존과 동일 -->
        <div id="checklist" class="tab-content">
            <h2>📋 점수 매기기 가이드 (팀원용)</h2>
            <!-- 기존 체크리스트 내용 동일 -->
        </div>

        <!-- 다른 탭들도 기존 내용 그대로 유지 -->
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // ⚠️ 여기에 Firebase 설정을 넣으세요 (Step 4에서 설명)
        const firebaseConfig = {
            apiKey: "AIzaSyBQ8Y-YixAjJscZ8s4_eFMjVbtxZpD1Mko",
            authDomain: "influencer-seeding-8b702.firebaseapp.com",
            databaseURL: "https://influencer-seeding-8b702-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "influencer-seeding-8b702",
            storageBucket: "influencer-seeding-8b702.firebasestorage.app",
            messagingSenderId: "730517045041",
            appId: "1:730517045041:web:0524c5f5157f9e42dcba10"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const influencersRef = database.ref('influencers');

        let influencers = [];
        let rowCount = 0;

        // Firebase 연결 상태 확인
        database.ref('.info/connected').on('value', function (snapshot) {
            const status = document.getElementById('firebaseStatus');
            if (snapshot.val() === true) {
                status.innerHTML = '✅ Firebase 연결됨 - 실시간 동기화 활성';
                status.className = 'firebase-status';
            } else {
                status.innerHTML = '❌ Firebase 연결 끊어짐';
                status.className = 'firebase-error';
            }
        });

        // 데이터 로드
        influencersRef.on('value', function (snapshot) {
            const data = snapshot.val();
            influencers = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
            renderTable();
            updateStats();
        });

        function renderTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            influencers.forEach((influencer, index) => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><input type="text" value="${influencer.name || ''}" onchange="updateInfluencer('${influencer.id}', 'name', this.value)" style="width:100px;"></td>
                    <td>
                        <select onchange="updateInfluencer('${influencer.id}', 'platform', this.value)">
                            <option value="Instagram" ${influencer.platform === 'Instagram' ? 'selected' : ''}>Instagram</option>
                            <option value="TikTok" ${influencer.platform === 'TikTok' ? 'selected' : ''}>TikTok</option>
                        </select>
                    </td>
                    <td>
                        <select onchange="updateInfluencer('${influencer.id}', 'brand', this.value)">
                            <option value="미정" ${influencer.brand === '미정' ? 'selected' : ''}>미정</option>
                            <option value="ATP" ${influencer.brand === 'ATP' ? 'selected' : ''}>ATP</option>
                            <option value="RB" ${influencer.brand === 'RB' ? 'selected' : ''}>RB</option>
                            <option value="ZRD" ${influencer.brand === 'ZRD' ? 'selected' : ''}>ZRD</option>
                        </select>
                    </td>
                    <td><input type="text" value="${influencer.followers || ''}" onchange="updateInfluencer('${influencer.id}', 'followers', this.value)" style="width:60px;"></td>
                    <td><input type="text" value="${influencer.engagement || ''}" onchange="updateInfluencer('${influencer.id}', 'engagement', this.value)" style="width:50px;"></td>
                    <td><input type="number" class="score-input" max="20" value="${influencer.buyingPower || 0}" onchange="updateScore('${influencer.id}', 'buyingPower', this.value)"></td>
                    <td><input type="number" class="score-input" max="25" value="${influencer.trust || 0}" onchange="updateScore('${influencer.id}', 'trust', this.value)"></td>
                    <td><input type="number" class="score-input" max="20" value="${influencer.community || 0}" onchange="updateScore('${influencer.id}', 'community', this.value)"></td>
                    <td><input type="number" class="score-input" max="20" value="${influencer.targetMatch || 0}" onchange="updateScore('${influencer.id}', 'targetMatch', this.value)"></td>
                    <td><input type="number" class="score-input" max="15" value="${influencer.realUse || 0}" onchange="updateScore('${influencer.id}', 'realUse', this.value)"></td>
                    <td><input type="number" class="score-input" max="10" value="${influencer.reddit || 0}" onchange="updateScore('${influencer.id}', 'reddit', this.value)"></td>
                    <td class="total-score">${calculateTotal(influencer)}</td>
                    <td class="${getGradeClass(calculateTotal(influencer))}">${getGrade(calculateTotal(influencer))}</td>
                    <td>
                        <select onchange="updateInfluencer('${influencer.id}', 'assignee', this.value)">
                            <option value="미정" ${influencer.assignee === '미정' ? 'selected' : ''}>미정</option>
                            <option value="신희경" ${influencer.assignee === '신희경' ? 'selected' : ''}>신희경</option>
                            <option value="최연주" ${influencer.assignee === '최연주' ? 'selected' : ''}>최연주</option>
                            <option value="김유진" ${influencer.assignee === '김유진' ? 'selected' : ''}>김유진</option>
                        </select>
                    </td>
                    <td>
                        <select onchange="updateInfluencer('${influencer.id}', 'status', this.value)">
                            <option value="대기중" ${influencer.status === '대기중' ? 'selected' : ''}>대기중</option>
                            <option value="연락완료" ${influencer.status === '연락완료' ? 'selected' : ''}>연락완료</option>
                            <option value="답장받음" ${influencer.status === '답장받음' ? 'selected' : ''}>답장받음</option>
                            <option value="거절" ${influencer.status === '거절' ? 'selected' : ''}>거절</option>
                        </select>
                    </td>
                    <td><input type="text" value="${influencer.budget || ''}" onchange="updateInfluencer('${influencer.id}', 'budget', this.value)" style="width:80px;"></td>
                    <td><input type="text" value="${influencer.memo || ''}" onchange="updateInfluencer('${influencer.id}', 'memo', this.value)" style="width:100px;"></td>
                    <td><button class="delete-btn" onclick="deleteInfluencer('${influencer.id}')">삭제</button></td>
                `;
            });
        }

        function addInfluencer() {
            const newInfluencer = {
                name: '',
                platform: 'Instagram',
                brand: '미정',
                followers: '',
                engagement: '',
                buyingPower: 0,
                trust: 0,
                community: 0,
                targetMatch: 0,
                realUse: 0,
                reddit: 0,
                assignee: '미정',
                status: '대기중',
                budget: '',
                memo: ''
            };

            influencersRef.push(newInfluencer);
        }

        function deleteInfluencer(id) {
            if (confirm('정말로 삭제하시겠습니까?')) {
                influencersRef.child(id).remove();
            }
        }

        function updateInfluencer(id, field, value) {
            influencersRef.child(id).update({ [field]: value });
        }

        function updateScore(id, field, value) {
            influencersRef.child(id).update({ [field]: parseInt(value) || 0 });
        }

        function calculateTotal(influencer) {
            return (parseInt(influencer.buyingPower) || 0) +
                (parseInt(influencer.trust) || 0) +
                (parseInt(influencer.community) || 0) +
                (parseInt(influencer.targetMatch) || 0) +
                (parseInt(influencer.realUse) || 0) +
                (parseInt(influencer.reddit) || 0);
        }

        function getGrade(total) {
            if (total >= 90) return 'S';
            if (total >= 80) return 'A';
            if (total >= 60) return 'B';
            if (total >= 40) return 'C';
            return 'D';
        }

        function getGradeClass(total) {
            if (total >= 90) return 'priority-s';
            if (total >= 80) return 'priority-a';
            if (total >= 60) return 'priority-b';
            if (total >= 40) return 'priority-c';
            return 'priority-d';
        }

        function updateStats() {
            const totalCandidates = influencers.length;
            let aPriority = 0;
            let contacted = 0;
            let responded = 0;

            influencers.forEach(influencer => {
                const total = calculateTotal(influencer);
                if (total >= 80) aPriority++;

                if (influencer.status === '연락완료' || influencer.status === '답장받음') contacted++;
                if (influencer.status === '답장받음') responded++;
            });

            document.getElementById('totalCandidates').textContent = totalCandidates;
            document.getElementById('aPriority').textContent = aPriority;
            document.getElementById('contacted').textContent = contacted;
            document.getElementById('responded').textContent = responded;
        }

        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>

</html>